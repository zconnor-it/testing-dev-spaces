# Editor definition that prevents VS Code from starting in OpenShift Dev Spaces
# This creates a minimal "no-IDE" editor using Red Hat UBI
# Based on: https://eclipse.dev/che/docs/stable/administration-guide/configuring-editors-definitions/
schemaVersion: 2.2.2

attributes:
  controller.devfile.io/storage-type: per-workspace

metadata:
  name: no-vscode
  displayName: No VS Code Editor (Red Hat UBI)
  description: Minimal workspace without VS Code - uses Red Hat Universal Base Image
  tags:
    - No-IDE
    - Minimal
    - Red-Hat-UBI
  attributes:
    title: Minimal Workspace - No VS Code
    arch:
      - x86_64
      - arm64
    publisher: redhat-custom
    version: 1.0.0
    repository: https://github.com/zconnor-it/testing-dev-spaces
    firstPublicationDate: '2024-01-01'
    iconMediatype: image/svg+xml
    iconData: |
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke="#EE0000" stroke-width="2" fill="none"/>
        <line x1="15" y1="9" x2="9" y2="15" stroke="#EE0000" stroke-width="2"/>
        <line x1="9" y1="9" x2="15" y2="15" stroke="#EE0000" stroke-width="2"/>
      </svg>

components:
  # Explicit persistent volume with size
  - name: projects
    volume:
      size: 5Gi

  # Minimal runtime container
  - name: no-vscode-runtime
    attributes:
      controller.devfile.io/container-contribution: true
    container:
      image: 'registry.access.redhat.com/ubi9/ubi-minimal:latest'
      memoryLimit: 256Mi
      memoryRequest: 128Mi
      cpuLimit: 500m
      cpuRequest: 100m
      mountSources: true
      sourceMapping: /projects
      volumeMounts:
        - name: projects
          path: /projects
      command:
        - tail
      args:
        - -f
        - /dev/null
      env:
        - name: EDITOR_DISABLED
          value: "true"
