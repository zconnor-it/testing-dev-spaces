# Devfile for OpenShift Dev Spaces with Jupyter Notebook
# Reference: https://eclipse.dev/che/docs/stable/administration-guide/configuring-editors-definitions/

schemaVersion: 2.1.0

metadata:
  name: jupyter-workspace
  displayName: Jupyter Notebook Workspace
  description: Data science workspace with Jupyter Notebook

components:
  # Explicit volume with size
  - name: projects
    volume:
      size: 5Gi

  - name: jupyter
    container:
      image: registry.access.redhat.com/ubi9/python-311:latest
      memoryLimit: 4Gi
      memoryRequest: 1Gi
      mountSources: true
      sourceMapping: /projects
      volumeMounts:
        - name: projects
          path: /projects
      # Keep container running with tail
      args:
        - tail
        - -f
        - /dev/null
      endpoints:
        - name: jupyter
          targetPort: 8888
          exposure: public
          protocol: https
          attributes:
            type: main

commands:
  - id: install-jupyter
    exec:
      component: jupyter
      commandLine: pip install --user jupyterlab
      workingDir: /projects
      
  - id: start-jupyter
    exec:
      component: jupyter
      commandLine: ~/.local/bin/jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --ServerApp.token='' --ServerApp.password='' --notebook-dir=/projects
      workingDir: /projects
